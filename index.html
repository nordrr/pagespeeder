<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PageSpeed Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;800&family=Roboto+Mono:wght@400;500;700;800&display=swap"
      rel="stylesheet"
    />
    <script>
      (() => {
        try {
          const raw = localStorage.getItem("pagespeed-tracker-state-v1");
          const parsed = raw ? JSON.parse(raw) : null;
          const mode = parsed && typeof parsed.themeMode === "string" ? parsed.themeMode : "auto";
          const resolved = mode === "dark"
            ? "dark"
            : mode === "light"
              ? "light"
              : (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
          document.documentElement.dataset.theme = resolved;
          document.documentElement.style.colorScheme = resolved;
        } catch {
          // Ignore storage parse issues and fall back to default light styles.
        }
      })();
    </script>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="page-header">
      <div>
        <h1>PageSpeed Tracker</h1>
        <p>Track PageSpeed Insights over time, average results, and compare URLs.</p>
      </div>
      <div class="header-actions">
        <label class="theme-control" for="theme-mode">
          <span>Theme</span>
          <select id="theme-mode" name="themeMode" aria-label="Theme mode">
            <option value="auto">Auto</option>
            <option value="light">Light</option>
            <option value="dark">Dark</option>
          </select>
        </label>
        <button id="start-all" type="button">Start All</button>
        <button id="stop-all" type="button" class="secondary">Stop All</button>
      </div>
    </header>

    <main>
      <section class="panel controls-panel">
        <h2>Settings</h2>
        <form id="settings-form" autocomplete="off">
          <label>
            Google API Key
            <input id="api-key" name="apiKey" type="password" placeholder="AIza..." required />
          </label>
          <button type="submit">Save Settings</button>
        </form>
        <p class="hint">
          Poll interval is fixed at <strong>60 seconds</strong> (Google PSI minimum).
          Runs both <strong>mobile</strong> and <strong>desktop</strong> tests each cycle.
          Confidence is shown as a 95% interval: <code>mean ± points</code>.
        </p>
      </section>

      <section class="panel controls-panel">
        <h2>Add URL</h2>
        <form id="add-url-form" autocomplete="off">
          <label>
            URL
            <input id="url-input" name="url" type="url" placeholder="https://example.com" required />
          </label>
          <p id="shopify-pb-suggestion" class="inline-hint" hidden>
            Shopify preview URL detected.
            <button id="shopify-pb-action" type="button" class="inline-link-btn">
              Add <code>pb=0</code> to remove the preview bar
            </button>
          </p>
          <button type="submit">Add URL</button>
        </form>
      </section>

      <section class="panel">
        <div class="section-title-row">
          <h2>Tracked URLs</h2>
          <button id="clear-all" type="button" class="secondary danger">Clear All Data</button>
        </div>
        <div id="url-cards" class="url-cards"></div>
      </section>

      <section class="panel">
        <h2>Comparison Table</h2>
        <div class="table-wrap">
          <table id="comparison-table">
            <thead>
              <tr>
                <th data-sort-key="url" class="sortable">URL</th>
                <th data-sort-key="mode" class="sortable">Mode</th>
                <th data-sort-key="avgScore" class="sortable">Avg Score</th>
                <th data-sort-key="confidence" class="sortable">95% Confidence</th>
                <th data-sort-key="samples" class="sortable">Samples</th>
                <th data-sort-key="fcp" class="sortable">FCP</th>
                <th data-sort-key="si" class="sortable">SI</th>
                <th data-sort-key="lcp" class="sortable">LCP</th>
                <th data-sort-key="tbt" class="sortable">TBT</th>
                <th data-sort-key="cls" class="sortable">CLS</th>
              </tr>
            </thead>
            <tbody id="comparison-body">
              <tr>
                <td colspan="10" class="placeholder">No URLs yet. Add one above to begin tracking.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <template id="url-card-template">
      <article class="url-card">
        <header>
          <div class="url-identity">
            <div class="title-row">
              <button class="drag-handle" type="button" aria-label="Reorder URL" draggable="true">
                <svg viewBox="0 0 16 16" aria-hidden="true">
                  <circle cx="5" cy="3.5" r="1.1"></circle>
                  <circle cx="11" cy="3.5" r="1.1"></circle>
                  <circle cx="5" cy="8" r="1.1"></circle>
                  <circle cx="11" cy="8" r="1.1"></circle>
                  <circle cx="5" cy="12.5" r="1.1"></circle>
                  <circle cx="11" cy="12.5" r="1.1"></circle>
                </svg>
              </button>
              <button class="url-card-title" type="button" data-hint="Add a label">
                <span class="url-label-line"></span>
                <span class="url-title-url"></span>
              </button>
            </div>
            <input class="url-label-input" type="text" maxlength="80" placeholder="Add a label" />
            <p class="url-card-meta"></p>
          </div>
          <div class="url-card-actions">
            <button class="toggle-run icon-btn" type="button" aria-label="Pause"></button>
            <button class="run-now icon-btn secondary" type="button" aria-label="Run now"></button>
            <button class="remove icon-btn danger" type="button" aria-label="Remove"></button>
          </div>
        </header>
        <div class="url-card-content">
          <section class="details-section">
            <div class="summary-strip">
              <article class="summary-tile mobile" data-mode="mobile">
                <p class="tile-label">Mobile Avg</p>
                <p class="tile-score">--</p>
                <p class="tile-meta">±-- • 0 runs</p>
              </article>
              <article class="summary-tile desktop" data-mode="desktop">
                <p class="tile-label">Desktop Avg</p>
                <p class="tile-score">--</p>
                <p class="tile-meta">±-- • 0 runs</p>
              </article>
            </div>
            <table class="metric-summary-table">
              <thead>
                <tr>
                  <th>Metric</th>
                  <th>Mobile</th>
                  <th>Desktop</th>
                </tr>
              </thead>
              <tbody class="metric-summary-body"></tbody>
            </table>
          </section>
          <section class="score-history-section">
            <h4>Score Runs</h4>
            <div class="score-history-scroll">
              <table class="score-history-table">
                <thead>
                  <tr>
                    <th>Run</th>
                    <th>Mobile</th>
                    <th>Desktop</th>
                  </tr>
                </thead>
                <tbody class="score-history-body"></tbody>
              </table>
            </div>
          </section>
        </div>
        <p class="error-text"></p>
      </article>
    </template>

    <div id="run-detail-backdrop" class="run-detail-backdrop" hidden></div>
    <aside id="run-detail-panel" class="run-detail-panel" aria-hidden="true">
      <header class="run-detail-header">
        <h2>Run Details</h2>
        <button id="run-detail-close" type="button" class="secondary">Close</button>
      </header>
      <div id="run-detail-content" class="run-detail-content">
        <p class="placeholder">Click any score in Score Runs to inspect that single run.</p>
      </div>
    </aside>
    <div id="ui-tooltip" class="ui-tooltip" hidden></div>

    <script src="app.js"></script>
  </body>
</html>
